---
- name: Update Fortinet Firewall Policy
  fortios_ipv4_policy:
    host: "{{ fortigate_firewall[inventory_hostname]['host_ip'] }}"
    username: "{{ fortinet_username }}"
    password: "{{ fortinet_password }}"
    id: "{{ random_id | int }}"
    src_addr: "{{ fortigate_firewall[inventory_hostname]['source'] }}"
    dst_addr: "{{ fortigate_firewall[inventory_hostname]['destination'] }}"
    service: "{{ fortigate_firewall[inventory_hostname]['services'][item] }}"
    state: "{{ firewall_rule_state }}"
    policy_action: "{{ policy_action }}"
  loop: "{{ range(0, fortigate_firewall[inventory_hostname]['services']|length)|list }}"

- name: Update Fortinet Firewall Policy in Reverse Direction
  fortios_ipv4_policy:
    host: "{{ fortigate_firewall[inventory_hostname]['host_ip'] }}"
    username: "{{ fortinet_username }}"
    password: "{{ fortinet_password }}"
    id: "{{ random_id | int }}"
    src_addr: "{{ fortigate_firewall[inventory_hostname]['destination'] }}"
    dst_addr: "{{ fortigate_firewall[inventory_hostname]['source'] }}"
    service: "{{ fortigate_firewall[inventory_hostname]['services'][item] }}"
    state: "{{ firewall_rule_state }}"
    policy_action: "{{ policy_action }}"
  loop: "{{ range(0, fortigate_firewall[inventory_hostname]['services']|length)|list }}"
